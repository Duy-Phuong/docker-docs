<h4>Maven Projects POM File Parsing Problem</h4>
<h4>Summary (TL;DR)</h4>
<h4>Issue</h4>
<ul>
<li>Sample <a href="https://github.com/jenkins-training/time-tracker" title='"Time Tracker GitHub Project"'>Maven project</a> fail to build in Jenkins, but successful in command line</li>
<li>Maven build in Jenkins throws exception that includes "Caused by: java.lang.NoSuchFieldError: <strong>DEFAULT_USER_SETTINGS_FILE</strong>"</li>
</ul>
<h4>Affects</h4>
<ul>
<li>Jenkins 1.x or 2.x</li>
<li>Maven Integration plugin 2.5.1 or lower</li>
<li>Maven 3.5.0 or higher</li>
</ul>
<h4>Culprit</h4>
<ul>
<li><a href="https://plugins.jenkins.io/maven-plugin" title='"Maven Integration Plugin"'>Maven Integration Plugin</a> 2.5.1 or lower is not compatible with <a href="http://maven.apache.org/download.cgi" title='"Maven 3.5 Download"'>Maven 3.5.0</a> or higher. See <a href="https://issues.jenkins-ci.org/browse/JENKINS-43446" title='"Maven Integration Plugin issue with Maven 3.5"'>Jenkins Issue 43446</a>.</li>
</ul>
<h4>Workaround</h4>
<ul>
<li>Use <a href="https://archive.apache.org/dist/maven/maven-3/3.3.9/binaries/apache-maven-3.3.9-bin.zip" title='"Maven 3.3.9 Download"'>Maven 3.3.9</a> until Maven Integration Plugin is updated</li>
</ul>
<h4>Backstory</h4>
<h4>The Problem</h4>
<p>Several reports of the sample project <a href="https://github.com/jenkins-training/time-tracker" title='"Time Tracker GitHub Project"'><strong>Time Tracker</strong></a> <em>POM</em> file was not able to be parsed, but only within Jenkins. Initially, I thought this was something to do with the POM file structure itself, since, as a developer, I'm not above having bugs in my code. However, I was able to build successfully without Maven complaining about POM parsing issues while using my command line. I even tried it with my install of Jenkins and Maven I used to record the course -- all worked perfectly.</p>
<p>Then, I walked through the install steps with Jenkins, including Java, Maven and other tools needed -- using all the latest versions of all the tools (my general recommendation) all on a fresh install of my operating system. Like before, the <strong>Time Tracker</strong> project compiled flawlessly via the command line -- but, it <em>failed</em> in Jenkins as described by several students. For me, this was great news! If I can reproduce a problem - then I can solve it or work around it.</p>
<h4>The Issue</h4>
<p>The Maven build within Jenkins provided an exception output like this (edited for brevity):</p>
<pre class="editor-colors lang-text"><div class="line"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Executing Maven:  -B -f C:\Program Files (x86)\Jenkins\workspace\Maven Test\pom.xml clean package</span></span></span></div><div class="line"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>java.lang.reflect.InvocationTargetException</span></span></span></div><div class="line"><span class="syntax--text syntax--plain"><span>    </span><span class="syntax--meta syntax--paragraph syntax--text"><span>at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</span></span></span></div><div class="line"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>...</span></span></span></div><div class="line"><span class="syntax--text syntax--plain"><span>    </span><span class="syntax--meta syntax--paragraph syntax--text"><span>at java.lang.Thread.run(Thread.java:748)</span></span></span></div><div class="line"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Caused by: java.lang.NoSuchFieldError: DEFAULT_USER_SETTINGS_FILE</span></span></span></div><div class="line"><span class="syntax--text syntax--plain"><span>    </span><span class="syntax--meta syntax--paragraph syntax--text"><span>at org.apache.maven.cli.DefaultMavenExecutionRequestBuilder.settings(DefaultMavenExecutionRequestBuilder.java:658)</span></span></span></div><div class="line"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>    at org.apache.maven.cli.DefaultMavenExecutionRequestBuilder.getMavenExecutionRequest(DefaultMavenExecutionRequestBuilder.java:149)</span></span></span></div><div class="line"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>    at org.jvnet.hudson.maven3.launcher.Maven33Launcher.getMavenExecutionRequest(Maven33Launcher.java:150)</span></span></span></div><div class="line"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>    at org.jvnet.hudson.maven3.launcher.Maven33Launcher.main(Maven33Launcher.java:127)</span></span></span></div><div class="line"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>    ... 21 more</span></span></span></div><div class="line"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>ERROR: Failed to parse POMs</span></span></span></div><div class="line"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>java.io.IOException: java.lang.reflect.InvocationTargetException</span></span></span></div><div class="line"><span class="syntax--text syntax--plain"><span>    </span><span class="syntax--meta syntax--paragraph syntax--text"><span>at hudson.maven.Maven3Builder.call(Maven3Builder.java:179)</span></span></span></div><div class="line"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>    at hudson.maven.Maven3Builder.call(Maven3Builder.java:70)</span></span></span></div><div class="line"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>...</span></span></span></div><div class="line"><span class="syntax--text syntax--plain"><span>    </span><span class="syntax--meta syntax--paragraph syntax--text"><span>at ......remote call to Channel to Maven [C:\Program Files\Java\jdk1.8.0_131/bin/java, -cp, C:\Program Files (x86)\Jenkins\plugins\maven-plugin\WEB-INF\lib\maven33-agent-1.8.1.jar;C:\DevTools\apache-maven-3.5.0\boot\plexus-classworlds-2.5.2.jar;C:\DevTools\apache-maven-3.5.0/conf/logging, jenkins.maven3.agent.Maven33Main, C:\DevTools\apache-maven-3.5.0, C:\Program Files (x86)\Jenkins\war\WEB-INF\lib\remoting-3.7.jar, C:\Program Files (x86)\Jenkins\plugins\maven-plugin\WEB-INF\lib\maven33-interceptor-1.8.1.jar, C:\Program Files (x86)\Jenkins\plugins\maven-plugin\WEB-INF\lib\maven3-interceptor-commons-1.8.1.jar, 51474](Native Method)</span></span></span></div><div class="line"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>    at hudson.remoting.Channel.attachCallSiteStackTrace(Channel.java:1545)</span></span></span></div><div class="line"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>...</span></span></span></div><div class="line"><span class="syntax--text syntax--plain"><span>    </span><span class="syntax--meta syntax--paragraph syntax--text"><span>at hudson.model.Executor.run(Executor.java:405)</span></span></span></div><div class="line"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Caused by: java.lang.reflect.InvocationTargetException</span></span></span></div><div class="line"><span class="syntax--text syntax--plain"><span>    </span><span class="syntax--meta syntax--paragraph syntax--text"><span>at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</span></span></span></div><div class="line"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>...</span></span></span></div><div class="line"><span class="syntax--text syntax--plain"><span>    </span><span class="syntax--meta syntax--paragraph syntax--text"><span>at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)</span></span></span></div><div class="line"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>    at java.lang.Thread.run(Thread.java:748)</span></span></span></div><div class="line"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Caused by: java.lang.Exception: java.lang.reflect.InvocationTargetException</span></span></span></div><div class="line"><span class="syntax--text syntax--plain"><span>    </span><span class="syntax--meta syntax--paragraph syntax--text"><span>at jenkins.maven3.agent.Maven33Main.launch(Maven33Main.java:179)</span></span></span></div><div class="line"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>    ... 14 more</span></span></span></div><div class="line"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Caused by: java.lang.reflect.InvocationTargetException</span></span></span></div><div class="line"><span class="syntax--text syntax--plain"><span>    </span><span class="syntax--meta syntax--paragraph syntax--text"><span>at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</span></span></span></div><div class="line"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>...</span></span></span></div><div class="line"><span class="syntax--text syntax--plain"><span>    </span><span class="syntax--meta syntax--paragraph syntax--text"><span>at jenkins.maven3.agent.Maven33Main.launch(Maven33Main.java:176)</span></span></span></div><div class="line"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>    ... 14 more</span></span></span></div><div class="line"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Caused by: java.lang.NoSuchFieldError: DEFAULT_USER_SETTINGS_FILE</span></span></span></div><div class="line"><span class="syntax--text syntax--plain"><span>    </span><span class="syntax--meta syntax--paragraph syntax--text"><span>at org.apache.maven.cli.DefaultMavenExecutionRequestBuilder.settings(DefaultMavenExecutionRequestBuilder.java:658)</span></span></span></div><div class="line"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>...</span></span></span></div><div class="line"><span class="syntax--text syntax--plain"><span>    </span><span class="syntax--meta syntax--paragraph syntax--text"><span>at org.jvnet.hudson.maven3.launcher.Maven33Launcher.main(Maven33Launcher.java:127)</span></span></span></div><div class="line"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>    ... 21 more</span></span></span></div><div class="line"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>channel stopped</span></span></span></div><div class="line"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Finished: FAILURE</span></span></span></div></pre><h4>The Bug Report and Workaround</h4>
<p>This simply did not make sense -- it worked perfectly fine before. All that was different was newer versions of the tools in play. That was it, I did a quick search online and found this <a href="https://issues.jenkins-ci.org/browse/JENKINS-43446" title='"Maven Integration Plugin issue with Maven 3.5"'>Jenkins Issue 43446</a> that was still open. Basically, there is (was) a known issue with the latest version of Maven (3.5.0) and the current version (and likely past versions) of the <a href="https://plugins.jenkins.io/maven-plugin" title='"Maven Integration Plugin"'>Maven Integration Plugin</a>. The workaround recommended in the issue is to revert to a known good version of Maven until the plugin is updated to support Maven 3.5 and higher.</p>
<p>That's why it worked on the Jenkins installation I used to record the course. I was still running Maven 3.3.9 on that setup. My fresh install ran into the problem because I used Maven 3.5 with Jenkins and the Maven Integration plugin. When I installed <a href="https://archive.apache.org/dist/maven/maven-3/3.3.9/binaries/apache-maven-3.3.9-bin.zip" title='"Maven 3.3.9 Download"'>Apache Maven 3.3.9</a>, updated my Jenkins configuration to point to <em>that</em> version, and re-ran the build -- <strong>Time Tracker</strong> was successfully building again. <em>Viola!</em></p>
<p>It's annoying my students will <em>fail by default</em> until the Maven Integration plugin is updated to work with latest Maven.</p>
<h4>Reference Links</h4>
<ul>
<li><a href="https://github.com/jenkins-training/time-tracker" title='"Time Tracker GitHub Project"'>Time Tracker Sample Maven Project on GitHub</a> (please <em>fork</em> into your own account)</li>
<li><a href="http://maven.apache.org/download.cgi" title='"Maven 3.5 Download"'>Maven Downloads Page for latest Maven versions</a></li>
<li><a href="https://archive.apache.org/dist/maven/maven-3/3.3.9/binaries/apache-maven-3.3.9-bin.zip" title='"Maven 3.3.9 Download"'>Maven 3.3.9 Binary Zip Archive</a> (use this version for now)</li>
<li><a href="https://plugins.jenkins.io/maven-plugin" title='"Maven Integration Plugin"'>Jenkins Maven Integration plugin</a> page</li>
<li><a href="https://issues.jenkins-ci.org/browse/JENKINS-43446" title='"Maven Integration Plugin issue with Maven 3.5"'>Jenkins Issue 43446</a></li>
</ul>